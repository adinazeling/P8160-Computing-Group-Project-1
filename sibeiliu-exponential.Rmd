---
title: "scenario1-sibeiliu"
author: "Sibei Liu"
date: "2020/2/8"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = F,message = F)
require(survival)
library(broom)
library(tidyverse)
source("./sim.R")
```


```{r}
N = 100
exp_beta = rep(NA, N)
weibull_beta = rep(NA, N)
cox_beta = rep(NA, N)

for (i in 1:N) {
  
  #data generate
data = generate_data(N = 500, beta = 5, distribution = "exponential", lambda = 0.1, gamma = 4, alpha = 4)

  # Fit three survival distributions
  fit.exponential = survreg(Surv(data$time) ~ data$x, dist = "exponential") 
  fit.weibull = survreg(Surv(data$time) ~ data$x, dist = "weibull")
  fit.cox = coxph(Surv(data$time) ~ data$x) 
  
  # Save beta coefficients 
  exp_beta[i] = -fit.exponential$coefficients[-1]
  weibull_beta[i] = -fit.weibull$coefficients[-1] / fit.weibull$scale
  cox_beta[i] = fit.cox$coefficients[1]
  
}
```

```{r}
hist(exp_beta)
hist(weibull_beta)
hist(cox_beta)
# mean of beta
exp_mean=mean(exp_beta)
weilbull_mean=mean(weibull_beta)
cox_mean=mean(cox_beta)
# varience of beta
exp_var=var(exp_beta)
weilbull_var=var(weibull_beta)
cox_var=var(cox_beta)
# bias,mse
for (i in 1:N) {
exp_bias=mean(exp_beta[i]-exp_mean)
weilbull_bias=mean(weibull_beta[i]-weilbull_mean)
cox_bias=mean(cox_beta[i]-cox_mean)
exp_mse=mean((exp_beta[i]-5)^2)
weilbull_mse=mean((weibull_beta[i]-5)^2)
cox_mse=mean((cox_beta[i]-5)^2)
}
data.frame("type"=c("exp","weill","cox"),"mean"=c(exp_mean,weilbull_mean,cox_mean),"varience"=c(exp_var,weilbull_var,cox_var),"bias"= c(exp_bias,weilbull_bias,cox_bias),"mse"=c(exp_mse,weilbull_mse,cox_mse),"CI_lower"=c(exp_mean-sd(exp_beta)/length(exp_beta),weilbull_mean-sd(weibull_beta)/length(exp_beta),cox_mean-sd(cox_beta)/length(exp_beta)),"CI_upper"=c(exp_mean+sd(exp_beta)/length(exp_beta),weilbull_mean+sd(weibull_beta)/length(exp_beta),cox_mean+sd(cox_beta)/length(exp_beta)))
```
